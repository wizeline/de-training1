{
    "paragraphs": [
        {
            "text": "%md\n#  Spark Optimization Scenarios\nWelcome to the notebook of the sixth session. You’re very close to finishing the Wizeline Certification for Big Data Engineering with Spark!\nIf you have any feedback about our courses, email us at academy@wizeline.com or use the Academy Slack channel.\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:00:31+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<h1>Spark Optimization Scenarios</h1>\n<p>Welcome to the notebook of the sixth session. You’re very close to finishing the Wizeline Certification for Big Data Engineering with Spark!<br/>If you have any feedback about our courses, email us at <a href=\"mailto:a&#x63;&#97;&#x64;&#x65;&#109;&#121;@&#x77;&#x69;z&#101;&#x6c;&#x69;&#110;&#101;&#46;&#99;&#111;&#x6d;\">a&#x63;&#97;&#x64;&#x65;&#109;&#121;@&#x77;&#x69;z&#101;&#x6c;&#x69;&#110;&#101;&#46;&#99;&#111;&#x6d;</a> or use the Academy Slack channel.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058454_-1753267127",
            "id": "20180829-222909_1145138508",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "focus": true,
            "$$hashKey": "object:278",
            "dateFinished": "2019-05-09T17:00:31+0000",
            "dateStarted": "2019-05-09T17:00:31+0000"
        },
        {
            "text": "%md\n# About this Notebook\nToday there are no exercises in this notebook.\n\nYou find code that solves a specific request and is optimized with Spark features. Scala and PySpark versions are intercalated, each with or without %pyspark header.\n\nWe encourage you to read through the code explanations. Feel free to experiment and try to further optimize the code pieces. Remember, there is always room for improvement.\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:00:58+0000",
            "config": {
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9,
                "tableHide": false
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<h1>About this Notebook</h1>\n<p>Today there are no exercises in this notebook.</p>\n<p>You find code that solves a specific request and is optimized with Spark features. Scala and PySpark versions are intercalated, each with or without %pyspark header.</p>\n<p>We encourage you to read through the code explanations. Feel free to experiment and try to further optimize the code pieces. Remember, there is always room for improvement.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058466_-1975879330",
            "id": "20180829-223008_1634680293",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:279",
            "dateFinished": "2019-05-09T17:00:58+0000",
            "dateStarted": "2019-05-09T17:00:58+0000"
        },
        {
            "text": "%md\n# Before We Begin\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:01:12+0000",
            "config": {
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9,
                "tableHide": false
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<h1>Before We Begin</h1>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058470_-864335631",
            "id": "20180829-223052_2122433210",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:280",
            "dateFinished": "2019-05-09T17:01:12+0000",
            "dateStarted": "2019-05-09T17:01:12+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058470_709688767",
            "id": "20180913-195057_1814517280",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:281"
        },
        {
            "text": "def checkPartitions(df: org.apache.spark.sql.DataFrame) = {\n    println(\"Number of partitions used: \" + df.rdd.getNumPartitions)\n    println(\"Sample of objects per partitions\")\n    df.mapPartitions(partition => Seq(partition.size).iterator).show(20)\n}\n",
            "user": "anonymous",
            "dateUpdated": "2019-04-26T02:56:46+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false,
                    "completionKey": "TAB",
                    "completionSupport": true
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "TEXT",
                        "data": "checkPartitions: (df: org.apache.spark.sql.DataFrame)Unit\n"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058471_-2053708306",
            "id": "20180829-223307_2068370091",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-26T02:56:47+0000",
            "dateFinished": "2019-04-26T02:57:26+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:282"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058471_-1961307798",
            "id": "20180918-180303_1800577945",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:283"
        },
        {
            "text": "%pyspark\nimport pyspark.sql.functions as fun\nfrom pyspark.sql.functions import month\nfrom pyspark.sql import Row\nfrom operator import add\n\ndef check_partitions(df):\n    print(\"Number of partitions used: {}\".format(df.rdd.getNumPartitions()))\n    print(\"Sample of objects per partitions\")\n    print(df.rdd.mapPartitions(lambda partition: [Row(value=sum(1 for _ in partition))]).take(20))",
            "user": "anonymous",
            "dateUpdated": "2019-04-26T02:57:05+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false,
                    "completionKey": "TAB",
                    "completionSupport": true
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": []
            },
            "apps": [],
            "jobName": "paragraph_1556236058472_1251903616",
            "id": "20180829-223101_538753799",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-26T02:57:06+0000",
            "dateFinished": "2019-04-26T02:57:26+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:284"
        },
        {
            "text": "%md Let’s also load up the base file:",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>Let’s also load up the base file:</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058473_-1872096220",
            "id": "20180829-223526_208873282",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:285"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058475_240182653",
            "id": "20180919-161124_1226365757",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:286"
        },
        {
            "text": "val orders  = spark.read.json(\"gs://de-training-input/alimazon/50000/client-orders/\")\nval ordersSample = orders.sample(false, 0.25).cache()",
            "user": "anonymous",
            "dateUpdated": "2019-04-26T02:57:44+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "TEXT",
                        "data": "orders: org.apache.spark.sql.DataFrame = [client_id: string, id: string ... 4 more fields]\nordersSample: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [client_id: string, id: string ... 4 more fields]\n"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058475_13842836",
            "id": "20180829-223544_1641843554",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-26T02:57:44+0000",
            "dateFinished": "2019-04-26T02:57:59+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:287"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:48:11+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058477_-1796990168",
            "id": "20180919-161149_1402187491",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-25T23:48:11+0000",
            "dateFinished": "2019-04-25T23:48:11+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:288"
        },
        {
            "text": "%pyspark\norders = spark.read.json(\"gs://de-training-input/alimazon/50000/client-orders/\")\norders_sample = orders.sample(False, 0.25).cache() # sample 25% of the dataset without replacement",
            "user": "anonymous",
            "dateUpdated": "2019-04-26T02:57:56+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": []
            },
            "apps": [],
            "jobName": "paragraph_1556236058477_-1194986247",
            "id": "20180829-223536_1861014599",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-26T02:57:56+0000",
            "dateFinished": "2019-04-26T02:58:00+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:289"
        },
        {
            "text": "%md\n**NOTE:** For a clearer benchmark, cache is used at several points in this notebook.\n",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p><strong>NOTE:</strong> For a clearer benchmark, cache is used at several points in this notebook.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058479_-942559368",
            "id": "20180829-223602_63436214",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:290"
        },
        {
            "text": "%md\n# Live Code 1 - Catalyst Advantages\n\nThe Alimazon marketing team wants to run a digital ad campaign on their website. They intend to target each client with ads related to the items they spend the most money on. You will deliver a report with the amount of money spent by each user on every product they have ever purchased. Be sure to sort the report by users and total amount spent per unique product.\n\nYour first approach was to use RDDs. As a good practice, you print only the first 20 rows to review your own results before creating the full report. You made good use of the Map operations and RDD properties for the task at hand.\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:01:40+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<h1>Live Code 1 - Catalyst Advantages</h1>\n<p>The Alimazon marketing team wants to run a digital ad campaign on their website. They intend to target each client with ads related to the items they spend the most money on. You will deliver a report with the amount of money spent by each user on every product they have ever purchased. Be sure to sort the report by users and total amount spent per unique product.</p>\n<p>Your first approach was to use RDDs. As a good practice, you print only the first 20 rows to review your own results before creating the full report. You made good use of the Map operations and RDD properties for the task at hand.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058481_-793282323",
            "id": "20180829-223629_1747329333",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:291",
            "dateFinished": "2019-05-09T17:01:40+0000",
            "dateStarted": "2019-05-09T17:01:40+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058481_-1882876064",
            "id": "20180918-180658_720004346",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:292"
        },
        {
            "text": "val ordersRDD = ordersSample.rdd\nval sortedRows = ordersRDD.map(row => ((row.getString(0), row.getString(2)), row.getDouble(5))).groupByKey.map{ case (key, iter) => (key, iter.sum) }.sortBy(row => (row._1._1,  row._2), ascending = false).take(20)\n    \nsortedRows.foreach(println)",
            "user": "anonymous",
            "dateUpdated": "2019-04-26T03:05:12+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "TEXT",
                        "data": "ordersRDD: org.apache.spark.rdd.RDD[org.apache.spark.sql.Row] = MapPartitionsRDD[18] at rdd at <console>:27\nsortedRows: Array[((String, String), Double)] = Array(((ffff3382-39d8-4b6a-a45b-1271a037c221,B007YUQHR4),44.71), ((fff2a0bd-764b-40e2-922c-fd489efd77c8,1429244097),5537.73), ((fff2a0bd-764b-40e2-922c-fd489efd77c8,1463524595),1715.58), ((fff2a0bd-764b-40e2-922c-fd489efd77c8,B00C766ERS),883.44), ((ffea5574-637d-4fd6-941a-60557b8dc032,B00JWZ43OI),1456.12), ((ffea5574-637d-4fd6-941a-60557b8dc032,0536696519),1171.71), ((ffea5574-637d-4fd6-941a-60557b8dc032,B00JCZXIQM),734.64), ((ffea5574-637d-4fd6-941a-60557b8dc032,B001DCN1YQ),345.46), ((ffea5574-637d-4fd6-941a-60557b8dc032,B007CDDDAC),12.84), ((ffd93c80-4c15-4fc7-84f5-980d13ff6092,B001E0T722),9466.98), ((ffd93c80-4c15-4fc7-84f5-980d13ff6092,0764126741),7578.9), ((ffd93c80-4c15-4fc7-84f5-980d13ff6092,1410105083),2655.8), ((ffd93c80-4c15-4fc7...((ffff3382-39d8-4b6a-a45b-1271a037c221,B007YUQHR4),44.71)\n((fff2a0bd-764b-40e2-922c-fd489efd77c8,1429244097),5537.73)\n((fff2a0bd-764b-40e2-922c-fd489efd77c8,1463524595),1715.58)\n((fff2a0bd-764b-40e2-922c-fd489efd77c8,B00C766ERS),883.44)\n((ffea5574-637d-4fd6-941a-60557b8dc032,B00JWZ43OI),1456.12)\n((ffea5574-637d-4fd6-941a-60557b8dc032,0536696519),1171.71)\n((ffea5574-637d-4fd6-941a-60557b8dc032,B00JCZXIQM),734.64)\n((ffea5574-637d-4fd6-941a-60557b8dc032,B001DCN1YQ),345.46)\n((ffea5574-637d-4fd6-941a-60557b8dc032,B007CDDDAC),12.84)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,B001E0T722),9466.98)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,0764126741),7578.9)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,1410105083),2655.8)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,0309112982),2119.75)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,B00C0TZHGG),1903.68)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,B005LIFN5S),1865.17)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,B002M78PZ6),1298.33)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,B003E1VVZU),1188.0)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,B00ILGGW5C),1002.69)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,147923365X),765.1)\n((ffd93c80-4c15-4fc7-84f5-980d13ff6092,B00IEWWC16),456.57)\n"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058482_1908455358",
            "id": "20180829-223922_1652280103",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-26T03:05:12+0000",
            "dateFinished": "2019-04-26T03:05:16+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:293"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058482_-1720201333",
            "id": "20180918-181000_528885233",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:294"
        },
        {
            "text": "%pyspark\norders_RDD = orders_sample.rdd\nsorted_rows = orders_RDD.map(lambda row: ((row[0], row[2]), row[5])) \\\n                        .groupByKey() \\\n                        .map(lambda row: (row[0], sum(row[1]))) \\\n                        .sortBy(lambda row: (row[0][0], row[1]), ascending = False) \\\n                        .take(20)\nfor row in sorted_rows:\n    print(row)",
            "user": "anonymous",
            "dateUpdated": "2019-04-26T03:05:41+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "TEXT",
                        "data": "((u'ffff3382-39d8-4b6a-a45b-1271a037c221', u'B00DEJRVII'), 1541.92)\n((u'ffff3382-39d8-4b6a-a45b-1271a037c221', u'2764110707'), 101.44)\n((u'ffff3382-39d8-4b6a-a45b-1271a037c221', u'B007YUQHR4'), 44.71)\n((u'fff914d0-234e-4b96-ab09-83b2f6a202bf', u'B00TKI6V38'), 3729.75)\n((u'fff2a0bd-764b-40e2-922c-fd489efd77c8', u'B0026IB8M8'), 1222.08)\n((u'fff2a0bd-764b-40e2-922c-fd489efd77c8', u'B003IDF2AE'), 297.0)\n((u'fff2a0bd-764b-40e2-922c-fd489efd77c8', u'B0000959F8'), 68.56)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'B001E0T722'), 9466.98)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'0764126741'), 7578.9)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'B00JTG0XDA'), 7068.06)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'0229642330'), 4595.1)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'B00ICUNSDQ'), 4115.36)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'B005LIFN5S'), 1865.17)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'B00IWOJM4Q'), 1179.8)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'B00ILGGW5C'), 1002.69)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'B00LFPQBAM'), 237.51)\n((u'ffd93c80-4c15-4fc7-84f5-980d13ff6092', u'B00JGG7K3Y'), 57.2)\n((u'ffd11e76-fb32-4629-88d7-4f5fd72c5433', u'B00D8SS5A8'), 110.0)\n((u'ff926a2e-2d6e-4571-bc48-220eaa1b2f58', u'B00JFCGBHA'), 313.32)\n((u'ff926a2e-2d6e-4571-bc48-220eaa1b2f58', u'B00OJ92P7E'), 191.42)\n"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058483_-167565506",
            "id": "20180829-223904_1848044529",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-26T03:05:41+0000",
            "dateFinished": "2019-04-26T03:05:43+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:295"
        },
        {
            "text": "%md\n\nThe code seems to produce the correct results (if you’re running both the Python and Scala versions, you may see discrepancies in the results due to the random sampling done at the beginning of this notebook). However, before running the `saveAsTextFile` method, notice how long it took to run with a small sample.\n\nTo optimize this run time, remember that `Spark 2.2.0` (the version you’re using) already has Catalyst optimizations if you use `DataFrames`. So, change your code accordingly and you get the optimization for free. In essence, if your software has implemented optimizations for you, it’s a good idea to take advantage of them.",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:03:33+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>The code seems to produce the correct results (if you’re running both the Python and Scala versions, you may see discrepancies in the results due to the random sampling done at the beginning of this notebook). However, before running the <code>saveAsTextFile</code> method, notice how long it took to run with a small sample.</p>\n<p>To optimize this run time, remember that <code>Spark 2.2.0</code> (the version you’re using) already has Catalyst optimizations if you use <code>DataFrames</code>. So, change your code accordingly and you get the optimization for free. In essence, if your software has implemented optimizations for you, it’s a good idea to take advantage of them.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058483_-646483923",
            "id": "20180829-223838_2106718386",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:296",
            "dateFinished": "2019-05-09T17:03:33+0000",
            "dateStarted": "2019-05-09T17:03:33+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058483_1935499507",
            "id": "20180918-181256_1934397781",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:297"
        },
        {
            "text": "// Optimal Scenario - Using DataFrames\nordersSample.groupBy(col(\"client_id\"), col(\"product_id\")).agg(sum(\"total\").alias(\"gross-sales\")).orderBy(desc(\"client_id\"), desc(\"gross-sales\")).show",
            "user": "anonymous",
            "dateUpdated": "2019-04-26T03:07:45+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "TEXT",
                        "data": "+--------------------+----------+-----------+\n|           client_id|product_id|gross-sales|\n+--------------------+----------+-----------+\n|ffff3382-39d8-4b6...|B007YUQHR4|      44.71|\n|fff2a0bd-764b-40e...|1429244097|    5537.73|\n|fff2a0bd-764b-40e...|1463524595|    1715.58|\n|fff2a0bd-764b-40e...|B00C766ERS|     883.44|\n|ffea5574-637d-4fd...|B00JWZ43OI|    1456.12|\n|ffea5574-637d-4fd...|0536696519|    1171.71|\n|ffea5574-637d-4fd...|B00JCZXIQM|     734.64|\n|ffea5574-637d-4fd...|B001DCN1YQ|     345.46|\n|ffea5574-637d-4fd...|B007CDDDAC|      12.84|\n|ffd93c80-4c15-4fc...|B001E0T722|    9466.98|\n|ffd93c80-4c15-4fc...|0764126741|     7578.9|\n|ffd93c80-4c15-4fc...|1410105083|     2655.8|\n|ffd93c80-4c15-4fc...|0309112982|    2119.75|\n|ffd93c80-4c15-4fc...|B00C0TZHGG|    1903.68|\n|ffd93c80-4c15-4fc...|B005LIFN5S|    1865.17|\n|ffd93c80-4c15-4fc...|B002M78PZ6|    1298.33|\n|ffd93c80-4c15-4fc...|B003E1VVZU|     1188.0|\n|ffd93c80-4c15-4fc...|B00ILGGW5C|    1002.69|\n|ffd93c80-4c15-4fc...|147923365X|      765.1|\n|ffd93c80-4c15-4fc...|B00IEWWC16|     456.57|\n+--------------------+----------+-----------+\nonly showing top 20 rows\n\n"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058483_-1408332614",
            "id": "20180829-225010_174005329",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-26T03:07:45+0000",
            "dateFinished": "2019-04-26T03:07:51+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:298"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058484_1150862344",
            "id": "20180918-181945_1097966897",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:299"
        },
        {
            "text": "%pyspark\n\n# Optimal Scenario - Using DataFrames\norders_sample.groupBy(fun.col(\"client_id\"), fun.col(\"product_id\")) \\\n      .agg(fun.sum(\"total\").alias(\"gross-sales\")) \\\n      .orderBy(fun.desc(\"client_id\"), fun.desc(\"gross-sales\")) \\\n      .show()",
            "user": "anonymous",
            "dateUpdated": "2019-04-26T03:07:56+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058484_964018773",
            "id": "20180829-224950_201420839",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-04-26T03:07:56+0000",
            "dateFinished": "2019-04-26T03:08:00+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:300",
            "errorMessage": ""
        },
        {
            "text": "%md\nNow that the execution time has been greatly reduced, you can see how your final implementation takes advantage of Catalyst. Although both pieces of codes perform approximately the same task, the final one has been optimized on the backend by Spark.\nAn alternative version through the RDD route would be using `reduceByKey` or `aggByKey`. According to the documentation, either of these can reduce the latency when working with RDDs by first reducing them locally, then shuffling, and finally reducing again",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:03:58+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>Now that the execution time has been greatly reduced, you can see how your final implementation takes advantage of Catalyst. Although both pieces of codes perform approximately the same task, the final one has been optimized on the backend by Spark.<br/>An alternative version through the RDD route would be using <code>reduceByKey</code> or <code>aggByKey</code>. According to the documentation, either of these can reduce the latency when working with RDDs by first reducing them locally, then shuffling, and finally reducing again</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058484_-815478110",
            "id": "20180829-224057_45519513",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "dateStarted": "2019-05-09T17:03:58+0000",
            "dateFinished": "2019-05-09T17:03:58+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:301"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058485_-201528450",
            "id": "20180918-182613_1831992341",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:302"
        },
        {
            "text": "// Optimization using reduceByKey\nval sortedRows = ordersRDD.map(row => ((row.getString(0), row.getString(2)), row.getDouble(5)))\n                          .reduceByKey(_+_)\n                          .sortBy(pair => (pair._1._1,  pair._2), ascending = false)\n                          .take(20)\n\nsortedRows.foreach(println)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058486_-645710730",
            "id": "20180829-210413_306858813",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:303"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058486_-460227254",
            "id": "20180918-182655_1509782753",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:304"
        },
        {
            "text": "%pyspark\n\n# Opimization Using reduceByKey\nsorted_rows = orders_RDD.map(lambda row: ((row[0], row[2]), row[5])) \\\n                        .reduceByKey(add) \\\n                        .sortBy(lambda row: (row[0][0], row[1]), ascending = False) \\\n                        .take(20)\n\nfor row in sorted_rows:\n    print(row)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058487_939406799",
            "id": "20180829-192512_1773196375",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:305"
        },
        {
            "text": "%md\nDoes the benchmark result make sense? Which one would you choose and why? What would happen with even more data? What else could you do to keep improving this code piece?\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:04:13+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>Does the benchmark result make sense? Which one would you choose and why? What would happen with even more data? What else could you do to keep improving this code piece?</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058488_-1748295436",
            "id": "20180829-224121_622882701",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:306",
            "dateFinished": "2019-05-09T17:04:13+0000",
            "dateStarted": "2019-05-09T17:04:13+0000"
        },
        {
            "text": "%md\n# Live Code 2 - Optimize with Repartition and Cache\nThe marketing campaign was a success! Even the marketing VP took an interest in your work with Spark and met directly with you to present his latest idea to you. To extract more utility from the Alimazon dataset, he would like to study how users spend their money.\n\nYour task, should you choose to accept it, is to compute the SUM, MEAN, MAX, and MIN of the money spent by each user on the Alimazon orders dataset. This sounds quite easy, considering the previous request.\n\nFor some reason, the Marketing VP also wants the metrics in separate files. You go ahead and create the following code.\n\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:04:57+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<h1>Live Code 2 - Optimize with Repartition and Cache</h1>\n<p>The marketing campaign was a success! Even the marketing VP took an interest in your work with Spark and met directly with you to present his latest idea to you. To extract more utility from the Alimazon dataset, he would like to study how users spend their money.</p>\n<p>Your task, should you choose to accept it, is to compute the SUM, MEAN, MAX, and MIN of the money spent by each user on the Alimazon orders dataset. This sounds quite easy, considering the previous request.</p>\n<p>For some reason, the Marketing VP also wants the metrics in separate files. You go ahead and create the following code.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058489_-735040985",
            "id": "20180829-225242_1534870793",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:307",
            "dateFinished": "2019-05-09T17:04:57+0000",
            "dateStarted": "2019-05-09T17:04:57+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058490_657119864",
            "id": "20180918-183022_543642833",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:308"
        },
        {
            "text": "// Base Scenario - Data as read by spark\norders.show\norders.groupBy(\"client_id\").sum(\"total\").show\norders.groupBy(\"client_id\").avg(\"total\").show\norders.groupBy(\"client_id\").min(\"total\").show\norders.groupBy(\"client_id\").max(\"total\").show",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058490_2039196194",
            "id": "20180829-225337_785829570",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:309"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058490_-409183903",
            "id": "20180918-183034_443605703",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:310"
        },
        {
            "text": "%pyspark\n\n# Base Scenario - Data as read by spark\norders.show()\norders.groupBy(\"client_id\").sum(\"total\").show()\norders.groupBy(\"client_id\").avg(\"total\").show()\norders.groupBy(\"client_id\").min(\"total\").show()\norders.groupBy(\"client_id\").max(\"total\").show()",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058490_1462436976",
            "id": "20180829-225331_739320534",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:311"
        },
        {
            "text": "%md\nThis was fairly easy compared to the previous task. Yet, being the efficiency-hungry developer you are, you think there is a way to make this code work faster. You go with the `repartition` method, because it makes sense to order data with the column you will use later. You expect the shuffling and latency to be reduced significantly.",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:05:14+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>This was fairly easy compared to the previous task. Yet, being the efficiency-hungry developer you are, you think there is a way to make this code work faster. You go with the <code>repartition</code> method, because it makes sense to order data with the column you will use later. You expect the shuffling and latency to be reduced significantly.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058491_72546856",
            "id": "20180829-225501_317647165",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:312",
            "dateFinished": "2019-05-09T17:05:14+0000",
            "dateStarted": "2019-05-09T17:05:14+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058491_1491570083",
            "id": "20180918-183348_690456626",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:313"
        },
        {
            "text": "// Using checkPartition function\nval ordersRepartitioned = orders.repartition($\"client_id\")\nordersRepartitioned.show\ncheckPartitions(orders)\ncheckPartitions(ordersRepartitioned)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058491_2137468180",
            "id": "20180829-225754_1372456767",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:314"
        },
        {
            "text": "// Failed \"Improvement\" Scenario - Repartitioned data\nordersRepartitioned.groupBy(\"client_id\").sum(\"total\").show\nordersRepartitioned.groupBy(\"client_id\").avg(\"total\").show\nordersRepartitioned.groupBy(\"client_id\").min(\"total\").show\nordersRepartitioned.groupBy(\"client_id\").max(\"total\").show",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058492_-636187536",
            "id": "20180829-225532_334396161",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:315"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058492_-1439828583",
            "id": "20180918-183359_511725392",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:316"
        },
        {
            "text": "%pyspark\n\n# Using checkPartition function\norders_repartitioned = orders.repartition(\"client_id\")\norders_repartitioned.show\ncheck_partitions(orders)\ncheck_partitions(orders_repartitioned)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058493_1790347401",
            "id": "20180829-225743_1301521202",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:317"
        },
        {
            "text": "%pyspark\n\n# Failed \"Improvement\" Scenario - Repartitioned data\norders_repartitioned.groupBy(\"client_id\").sum(\"total\").show()\norders_repartitioned.groupBy(\"client_id\").avg(\"total\").show()\norders_repartitioned.groupBy(\"client_id\").min(\"total\").show()\norders_repartitioned.groupBy(\"client_id\").max(\"total\").show()",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058493_528885707",
            "id": "20180829-225523_676296318",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:318"
        },
        {
            "text": "%md\nWeirdly, performance does not improve as much as you were expecting it to. You use a quick function to monitor the partitions. You think something might have gone wrong with the partitioning that you can detect.\n\nAfter reviewing the results, you notice that the partitions are indeed different, but there isn’t anything obvious to optimize there. Repartition did its work! You decide to run the `explain` method.\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:05:34+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>Weirdly, performance does not improve as much as you were expecting it to. You use a quick function to monitor the partitions. You think something might have gone wrong with the partitioning that you can detect.</p>\n<p>After reviewing the results, you notice that the partitions are indeed different, but there isn’t anything obvious to optimize there. Repartition did its work! You decide to run the <code>explain</code> method.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058493_1980808171",
            "id": "20180829-225601_437916405",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:319",
            "dateFinished": "2019-05-09T17:05:34+0000",
            "dateStarted": "2019-05-09T17:05:34+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058494_68976786",
            "id": "20180918-183730_1257070568",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:320"
        },
        {
            "text": "orders.explain\nordersRepartitioned.explain",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058495_468629856",
            "id": "20180829-230249_1160763117",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:321"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058495_-32303504",
            "id": "20180918-183751_1287390156",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:322"
        },
        {
            "text": "%pyspark\norders.explain()\norders_repartitioned.explain()",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058496_-2043456000",
            "id": "20180829-230236_608426328",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:323"
        },
        {
            "text": "%md There it is. The shuffling still had to occur on each call to `show`. Going back to the documentation, you realize you might have made a mistake with the cache location. Each action executes the full DAG, taking cache into account, which means the repartition method happened again with every action. A quick rewrite solves it.",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:07:01+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>There it is. The shuffling still had to occur on each call to <code>show</code>. Going back to the documentation, you realize you might have made a mistake with the cache location. Each action executes the full DAG, taking cache into account, which means the repartition method happened again with every action. A quick rewrite solves it.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058501_158421608",
            "id": "20180829-230307_51822834",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:324",
            "dateFinished": "2019-05-09T17:07:01+0000",
            "dateStarted": "2019-05-09T17:07:01+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058502_2063415057",
            "id": "20180918-222301_1833927303",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:325"
        },
        {
            "text": "// Optimal Scenario - Repartitioned data\nval ordersRepartitionedCached  = orders.repartition($\"client_id\").cache\nordersRepartitionedCached.show\n\ncheckPartitions(ordersRepartitionedCached)\nordersRepartitionedCached.groupBy(\"client_id\").sum(\"total\").show\nordersRepartitionedCached.groupBy(\"client_id\").avg(\"total\").show\nordersRepartitionedCached.groupBy(\"client_id\").min(\"total\").show\nordersRepartitionedCached.groupBy(\"client_id\").max(\"total\").show",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058502_1717371371",
            "id": "20180829-192240_1457079661",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:326"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058502_1779715409",
            "id": "20180918-222312_829127060",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:327"
        },
        {
            "text": "%pyspark\n\n# Optimal Scenario - Repartitioned data\norders_repartitioned_cached  = orders.repartition(\"client_id\").cache()\norders_repartitioned_cached.show\ncheck_partitions(orders_repartitioned_cached)\n\norders_repartitioned_cached.groupBy(\"client_id\").sum(\"total\").show()\norders_repartitioned_cached.groupBy(\"client_id\").avg(\"total\").show()\norders_repartitioned_cached.groupBy(\"client_id\").min(\"total\").show()\norders_repartitioned_cached.groupBy(\"client_id\").max(\"total\").show() ",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058503_1842356141",
            "id": "20180829-214700_1621651268",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:328"
        },
        {
            "text": "%md\nJust moving the cache solved your performance, because caching stores a point in your execution DAG in the selected storage level, until the next action requires it. This way, the correct usage of repartition and cache made the difference in execution time.",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:07:18+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>Just moving the cache solved your performance, because caching stores a point in your execution DAG in the selected storage level, until the next action requires it. This way, the correct usage of repartition and cache made the difference in execution time.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058506_-189249927",
            "id": "20180829-230337_936315368",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:329",
            "dateFinished": "2019-05-09T17:07:18+0000",
            "dateStarted": "2019-05-09T17:07:18+0000"
        },
        {
            "text": "%md\n# Live Code 3 - Optimize with Repartition\nNow that you’re moving up in the corporate ladder using Spark (because no one else knows how to use it in your organization), it is time to make some suggestions to make yourself more noticeable. You decide to push for an architectural change that will improve performance in your already generated reports. For this purpose, you want to experiment with repartition.\n\nYou know that the Alimazon storage is configured with monthly partitions. That does not seem optimal to you, but you need to generate some evidence to support your thoughts. You decide to run a few experimental partitions to observe if they are good for several shuffling scenarios.\n\n**NOTE:** Because of a limitation of Spark reading from GCS, we must simulate the partition by month that Alimazon uses using the following code:",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:10:00+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<h1>Live Code 3 - Optimize with Repartition</h1>\n<p>Now that you’re moving up in the corporate ladder using Spark (because no one else knows how to use it in your organization), it is time to make some suggestions to make yourself more noticeable. You decide to push for an architectural change that will improve performance in your already generated reports. For this purpose, you want to experiment with repartition.</p>\n<p>You know that the Alimazon storage is configured with monthly partitions. That does not seem optimal to you, but you need to generate some evidence to support your thoughts. You decide to run a few experimental partitions to observe if they are good for several shuffling scenarios.</p>\n<p><strong>NOTE:</strong> Because of a limitation of Spark reading from GCS, we must simulate the partition by month that Alimazon uses using the following code:</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058506_-1897002971",
            "id": "20180830-153040_1949700509",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:330",
            "dateFinished": "2019-05-09T17:10:00+0000",
            "dateStarted": "2019-05-09T17:10:00+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058506_-859141304",
            "id": "20180918-222403_1191106331",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:331"
        },
        {
            "text": "val ordersByMonth = orders.repartition(12, month($\"timestamp\").alias(\"month\")).cache\nordersByMonth.show",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058507_-353265914",
            "id": "20180830-153303_1383442079",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:332"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058507_-1480097277",
            "id": "20180918-222421_1336053316",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:333"
        },
        {
            "text": "%pyspark\n\norders_by_month = orders.repartition(12, month(\"timestamp\").alias(\"month\")).cache()\norders_by_month.show()",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058507_-1764914087",
            "id": "20180830-153137_747080515",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:334"
        },
        {
            "text": "%md\nFor the sake of simplicity, you decide to start testing with the same report metrics requested by the marketing VP. In this test, you want to obtain only the metrics for February, because that will reduce the computation time for the benchmark. More tests with distinct shuffling implications should be done, but this is a good start.\n\nYou run your partition analysis function first to study how the data is currently partitioned.\n\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:10:23+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>For the sake of simplicity, you decide to start testing with the same report metrics requested by the marketing VP. In this test, you want to obtain only the metrics for February, because that will reduce the computation time for the benchmark. More tests with distinct shuffling implications should be done, but this is a good start.</p>\n<p>You run your partition analysis function first to study how the data is currently partitioned.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058508_-150547126",
            "id": "20180830-153326_908443610",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:335",
            "dateFinished": "2019-05-09T17:10:23+0000",
            "dateStarted": "2019-05-09T17:10:23+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058508_-743903929",
            "id": "20180918-222622_770501782",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:336"
        },
        {
            "text": "checkPartitions(ordersByMonth)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058508_-418234306",
            "id": "20180830-153348_516778534",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:337"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058509_548020573",
            "id": "20180918-222636_1338718753",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:338"
        },
        {
            "text": "%pyspark\n\ncheck_partitions(orders_by_month)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058509_-1661780405",
            "id": "20180830-153344_2081551598",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:339"
        },
        {
            "text": "%md \nAfter checking the partitions, let’s run the base benchmark to measure the rest of your experiments. When benchmarking your code (or any optimizations), it is always wise to have a base scenario with minimal or no optimizations at all.\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:11:32+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>After checking the partitions, let’s run the base benchmark to measure the rest of your experiments. When benchmarking your code (or any optimizations), it is always wise to have a base scenario with minimal or no optimizations at all.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058512_421157668",
            "id": "20180830-153407_141959711",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:340",
            "dateFinished": "2019-05-09T17:11:32+0000",
            "dateStarted": "2019-05-09T17:11:32+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058512_-37114087",
            "id": "20180918-222946_578742017",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:341"
        },
        {
            "text": "// Base scenario: multiple metrics for february\nval ordersInFebruary = ordersByMonth.filter(month($\"timestamp\") === \"2\")\n\n// Exploring base scenario partitioning\nordersInFebruary.show\ncheckPartitions(ordersInFebruary)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058516_-635509216",
            "id": "20180830-175623_2069300436",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:342"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058516_-781794748",
            "id": "20180918-222956_41862595",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:343"
        },
        {
            "text": "%pyspark\n\n# Base scenario: multiple metrics for february\norders_in_february = orders_by_month.filter(month(\"timestamp\") == \"2\")\n\n# Exploring base scenario partitioning\norders_in_february.show()\ncheck_partitions(orders_in_february)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058516_-1718841061",
            "id": "20180830-175540_1781171772",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:344"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058517_1869322158",
            "id": "20180918-223629_2081868328",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:345"
        },
        {
            "text": "// Scala version\nordersInFebruary.groupBy(month($\"timestamp\")).sum(\"total\").show\nordersInFebruary.groupBy(month($\"timestamp\")).avg(\"total\").show\nordersInFebruary.groupBy(month($\"timestamp\")).min(\"total\").show\nordersInFebruary.groupBy(month($\"timestamp\")).max(\"total\").show",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058517_-1855644332",
            "id": "20180830-153849_2103987845",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:346"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058517_-2078153229",
            "id": "20180918-223639_689611166",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:347"
        },
        {
            "text": "%pyspark\n\n# Base scenario: multiple metrics for february\norders_in_february.groupBy(month(\"timestamp\")).sum(\"total\").show()\norders_in_february.groupBy(month(\"timestamp\")).avg(\"total\").show()\norders_in_february.groupBy(month(\"timestamp\")).min(\"total\").show()\norders_in_february.groupBy(month(\"timestamp\")).max(\"total\").show()",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058517_1825604078",
            "id": "20180830-153545_1864356302",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:348"
        },
        {
            "text": "%md \nCache is not directly used with `ordersInFebruary`, because although filter requires some computation time, it is optimized in Spark. Even more so, because it only has narrow dependencies. The results are fast, but that’s mostly because we dropped all months other than February so there were less partitions to work with in the nodes.\n\nNow you can proceed with your first repartition experiment. You want to avoid repartitioning by `client_id`, because you want to have something works for any shuffling scenario. You decide to start with an increased number of partitions on the month of February as a first approach.\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:16:28+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>Cache is not directly used with <code>ordersInFebruary</code>, because although filter requires some computation time, it is optimized in Spark. Even more so, because it only has narrow dependencies. The results are fast, but that’s mostly because we dropped all months other than February so there were less partitions to work with in the nodes.</p>\n<p>Now you can proceed with your first repartition experiment. You want to avoid repartitioning by <code>client_id</code>, because you want to have something works for any shuffling scenario. You decide to start with an increased number of partitions on the month of February as a first approach.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058518_2104957851",
            "id": "20180830-153946_1575142577",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:349",
            "dateFinished": "2019-05-09T17:16:28+0000",
            "dateStarted": "2019-05-09T17:16:28+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058519_1047400313",
            "id": "20180918-223805_1789312994",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:350"
        },
        {
            "text": "// Bad optimization scenario\nval ordersInFebruary = ordersByMonth.filter(month($\"timestamp\") === \"2\")\nval repartitionedOrdersInFebruary1 = ordersInFebruary.repartition(3000).cache\ncheckPartitions(repartitionedOrdersInFebruary1)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058520_-1066250775",
            "id": "20180830-154151_443575427",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:351"
        },
        {
            "text": "// Scala Version\nrepartitionedOrdersInFebruary1.groupBy(month($\"timestamp\")).sum(\"total\").show\nrepartitionedOrdersInFebruary1.groupBy(month($\"timestamp\")).avg(\"total\").show\nrepartitionedOrdersInFebruary1.groupBy(month($\"timestamp\")).min(\"total\").show\nrepartitionedOrdersInFebruary1.groupBy(month($\"timestamp\")).max(\"total\").show",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058520_864384720",
            "id": "20180830-175832_714783056",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:352"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058521_-1700848060",
            "id": "20180918-223822_487651124",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:353"
        },
        {
            "text": "%pyspark\n\n# Bad optimization scenario\norders_in_february = orders_by_month.filter(month(\"timestamp\") == \"2\")\nrepartitioned_orders_in_february1 = orders_in_february.repartition(3000).cache()\ncheck_partitions(orders_in_february)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058522_1481675551",
            "id": "20180830-154108_122475076",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:354"
        },
        {
            "text": "%pyspark\n\nrepartitioned_orders_in_february1.groupBy(month(\"timestamp\")).sum(\"total\").show()\nrepartitioned_orders_in_february1.groupBy(month(\"timestamp\")).avg(\"total\").show()\nrepartitioned_orders_in_february1.groupBy(month(\"timestamp\")).min(\"total\").show()\nrepartitioned_orders_in_february1.groupBy(month(\"timestamp\")).max(\"total\").show()",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058522_-98096514",
            "id": "20180830-175822_56277178",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:355"
        },
        {
            "text": "%md\nPerformance could certainly improve. This is proof that just adding more partitions is not directly linked to a better performance. As you can see in the `checkPartitions` output, plenty of partitions are empty, which is not good because it translates into useless computing time used by the worker nodes.\n\nAlso, remember that we’re working on a relatively small Spark cluster, which limits the amount of CPUs we have access to.\n\nConsidering that, let’s say we want to partition to something more manageable.\nLet’s repartition again separately (to have comparable benchmark results).\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:17:09+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>Performance could certainly improve. This is proof that just adding more partitions is not directly linked to a better performance. As you can see in the <code>checkPartitions</code> output, plenty of partitions are empty, which is not good because it translates into useless computing time used by the worker nodes.</p>\n<p>Also, remember that we’re working on a relatively small Spark cluster, which limits the amount of CPUs we have access to.</p>\n<p>Considering that, let’s say we want to partition to something more manageable.<br/>Let’s repartition again separately (to have comparable benchmark results).</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058523_1226366263",
            "id": "20180830-154230_1501626694",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:356",
            "dateFinished": "2019-05-09T17:17:09+0000",
            "dateStarted": "2019-05-09T17:17:09+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058524_1120447440",
            "id": "20180918-230608_1608538552",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:357"
        },
        {
            "text": "val repartitionedOrdersInFebruary2 = ordersInFebruary.repartition(9).cache\ncheckPartitions(repartitionedOrdersInFebruary2)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058524_1789825516",
            "id": "20180830-154306_2010352408",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:358"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058525_1052086271",
            "id": "20180918-230651_896323445",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:359"
        },
        {
            "text": "%pyspark\n\nrepartitioned_orders_in_february2 = orders_in_february.repartition(9).cache()\ncheck_partitions(repartitioned_orders_in_february2)",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058526_428894916",
            "id": "20180830-154254_213443068",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:360"
        },
        {
            "text": "%md \nThe output of checkPartitions no longer has empty partitions. Let’s see how our benchmark code behaves with these bigger sets.",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:17:26+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>The output of checkPartitions no longer has empty partitions. Let’s see how our benchmark code behaves with these bigger sets.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058526_-1455446059",
            "id": "20180830-154400_1865638795",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:361",
            "dateFinished": "2019-05-09T17:17:26+0000",
            "dateStarted": "2019-05-09T17:17:26+0000"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/nRs6Nz/scala.png\" alt=\"Scala\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058527_400125274",
            "id": "20180918-230702_293936432",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:362"
        },
        {
            "text": "// Optimal solution\nrepartitionedOrdersInFebruary2.groupBy(month($\"timestamp\")).sum(\"total\").show\nrepartitionedOrdersInFebruary2.groupBy(month($\"timestamp\")).avg(\"total\").show\nrepartitionedOrdersInFebruary2.groupBy(month($\"timestamp\")).min(\"total\").show\nrepartitionedOrdersInFebruary2.groupBy(month($\"timestamp\")).max(\"total\").show",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala"
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058528_-105563474",
            "id": "20180829-192450_551330582",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:363"
        },
        {
            "text": "%md <img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<img src=\"https://image.ibb.co/k8qhvK/python.png\" alt=\"Python\">\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058528_-1409545635",
            "id": "20180918-230714_838772688",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:364"
        },
        {
            "text": "%pyspark\n\n# Optimal solution\nrepartitioned_orders_in_february2.groupBy(month(\"timestamp\")).sum(\"total\").show()\nrepartitioned_orders_in_february2.groupBy(month(\"timestamp\")).avg(\"total\").show()\nrepartitioned_orders_in_february2.groupBy(month(\"timestamp\")).min(\"total\").show()\nrepartitioned_orders_in_february2.groupBy(month(\"timestamp\")).max(\"total\").show()",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/python",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "python",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058529_2115447229",
            "id": "20180829-220518_1718371005",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:365"
        },
        {
            "text": "%md\nYou see that performance significantly improved compared to the other scenarios. Even though partitions contain a larger amount of records, we must be aware of two things:\n\n1) Due to a DataProc configuration, we can only use three CPUs in our cluster.\n\n2) General rule-of-thumb for partitioning suggests three partitions per CPU. This allows the tasks to be scheduled more fairly between executor threads. However, this may not be efficient for all scenarios.\n",
            "user": "anonymous",
            "dateUpdated": "2019-05-09T17:18:13+0000",
            "config": {
                "tableHide": false,
                "editorSetting": {
                    "language": "markdown",
                    "editOnDblClick": true,
                    "completionSupport": false
                },
                "colWidth": 12,
                "editorMode": "ace/mode/markdown",
                "editorHide": true,
                "results": {},
                "enabled": true,
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "results": {
                "code": "SUCCESS",
                "msg": [
                    {
                        "type": "HTML",
                        "data": "<div class=\"markdown-body\">\n<p>You see that performance significantly improved compared to the other scenarios. Even though partitions contain a larger amount of records, we must be aware of two things:</p>\n<p>1) Due to a DataProc configuration, we can only use three CPUs in our cluster.</p>\n<p>2) General rule-of-thumb for partitioning suggests three partitions per CPU. This allows the tasks to be scheduled more fairly between executor threads. However, this may not be efficient for all scenarios.</p>\n</div>"
                    }
                ]
            },
            "apps": [],
            "jobName": "paragraph_1556236058530_167808066",
            "id": "20180829-230512_1037389140",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "FINISHED",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:366",
            "dateFinished": "2019-05-09T17:18:13+0000",
            "dateStarted": "2019-05-09T17:18:13+0000"
        },
        {
            "text": "",
            "user": "anonymous",
            "dateUpdated": "2019-04-25T23:47:38+0000",
            "config": {
                "colWidth": 12,
                "editorMode": "ace/mode/scala",
                "results": {},
                "enabled": true,
                "editorSetting": {
                    "language": "scala",
                    "editOnDblClick": false
                },
                "fontSize": 9
            },
            "settings": {
                "params": {},
                "forms": {}
            },
            "apps": [],
            "jobName": "paragraph_1556236058530_-732724059",
            "id": "20180830-154554_116265660",
            "dateCreated": "2019-04-25T23:47:38+0000",
            "status": "READY",
            "errorMessage": "",
            "progressUpdateIntervalMs": 500,
            "$$hashKey": "object:367"
        }
    ],
    "name": "c6-examples-exercises",
    "id": "2EBJ9SDPT",
    "noteParams": {},
    "noteForms": {},
    "angularObjects": {
        "md:shared_process": [],
        "spark:shared_process": []
    },
    "config": {
        "isZeppelinNotebookCronEnable": false,
        "looknfeel": "default",
        "personalizedMode": "false"
    },
    "info": {}
}
